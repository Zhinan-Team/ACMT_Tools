(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-5edfe8bb"],{"7e81":function(t,e,a){},"9ed6":function(t,e,a){"use strict";a.r(e);var s=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"login-container"},[a("el-card",{staticClass:"login-form"},[a("el-form",{ref:"loginForm",attrs:{model:t.loginForm,rules:t.loginRules,autocomplete:"on","label-position":"left"}},[a("div",{staticClass:"title-container"},[a("h3",{staticClass:"title"},[t._v("WELCOME TO ACMT! ")])]),a("el-form-item",{attrs:{prop:"username"}},[a("span",{staticClass:"svg-container"},[a("svg-icon",{attrs:{"icon-class":"user"}})],1),a("el-input",{ref:"username",attrs:{placeholder:"Username",name:"username",type:"text",clearable:"",tabindex:"1",autocomplete:"on"},model:{value:t.loginForm.username,callback:function(e){t.$set(t.loginForm,"username",e)},expression:"loginForm.username"}})],1),a("el-tooltip",{attrs:{content:"Caps lock is On",placement:"right",manual:""},model:{value:t.capsTooltip,callback:function(e){t.capsTooltip=e},expression:"capsTooltip"}},[a("el-form-item",{attrs:{prop:"password"}},[a("span",{staticClass:"svg-container"},[a("svg-icon",{attrs:{"icon-class":"password"}})],1),a("el-input",{key:t.passwordType,ref:"password",attrs:{type:t.passwordType,placeholder:"Password",name:"password",tabindex:"2",clearable:"",autocomplete:"on"},on:{blur:function(e){t.capsTooltip=!1}},nativeOn:{keyup:function(e){return t.checkCapslock(e)}},model:{value:t.loginForm.password,callback:function(e){t.$set(t.loginForm,"password",e)},expression:"loginForm.password"}}),a("span",{staticClass:"show-pwd",on:{click:t.showPwd}},[a("svg-icon",{attrs:{"icon-class":"password"===t.passwordType?"eye":"eye-open"}})],1)],1)],1),a("el-form-item",{attrs:{prop:"captcha"}},[a("el-col",{attrs:{span:17}},[a("span",{staticClass:"svg-container"},[a("svg-icon",{attrs:{"icon-class":"password"}})],1),a("el-input",{attrs:{type:"text",maxlength:"4",placeholder:"请输入验证码",clearable:"",autocomplete:"off"},scopedSlots:t._u([{key:"prefix",fn:function(){return[a("el-icon",{staticClass:"el-input__icon"},[a("ele-Position")],1)]},proxy:!0}]),model:{value:t.loginForm.captcha,callback:function(e){t.$set(t.loginForm,"captcha",e)},expression:"loginForm.captcha"}})],1),a("el-col",{attrs:{span:7}},[a("el-button",{staticClass:"login-content-captcha"},[a("el-image",{attrs:{src:t.loginForm.captchaImgBase},on:{click:t.refreshCaptcha}})],1)],1)],1),a("el-button",{staticClass:"login-content-submit",attrs:{loading:t.loading},nativeOn:{click:function(e){return e.preventDefault(),t.handleLogin(e)}}},[t._v("Login")])],1)],1),t._m(0)],1)},o=[function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"login-authorization z-10"},[a("p",[t._v("Copyright © COMAC 版权所有")])])}],n=a("c7eb"),r=a("1da1"),i=(a("d9e2"),a("4de4"),a("14d9"),a("b64b"),a("d3b7"),a("7ded")),c=a("1628"),l=a("a18c"),p={name:"Login",data:function(){var t=function(t,e,a){e.length<6?a(new Error("The password can not be less than 6 digits")):a()};return{loginForm:{username:"",password:"",captcha:"",captchaKey:"",captchaImgBase:""},loginRules:{username:[{required:!0,trigger:"blur"}],password:[{required:!0,trigger:"blur",validator:t}]},passwordType:"password",capsTooltip:!1,loading:!1,redirect:void 0,otherQuery:{}}},watch:{$route:{handler:function(t){var e=t.query;e&&(this.redirect=e.redirect,this.otherQuery=this.getOtherQuery(e))},immediate:!0}},created:function(){},mounted:function(){this.getCaptcha(),""===this.loginForm.username?this.$refs.username.focus():""===this.loginForm.password&&this.$refs.password.focus()},destroyed:function(){},methods:{checkCapslock:function(t){var e=t.key;this.capsTooltip=e&&1===e.length&&e>="A"&&e<="Z"},getCaptcha:function(){var t=this;this.$axios.get("/api/captcha/").then((function(e){t.loginForm.captchaImgBase=e.data.data.image_base,t.loginForm.captchaKey=e.data.data.key}))},refreshCaptcha:function(){var t=this;this.loginForm.captcha="",this.$axios.get("/api/captcha/").then((function(e){t.loginForm.captchaImgBase=e.data.data.image_base,t.loginForm.captchaKey=e.data.data.key}))},showPwd:function(){var t=this;"password"===this.passwordType?this.passwordType="":this.passwordType="password",this.$nextTick((function(){t.$refs.password.focus()}))},handleLogin:function(){var t=this;this.$refs.loginForm.validate((function(e){if(!e)return t.refreshCaptcha(),t.loading=!1,!1;t.loading=!0,t.$store.dispatch("user/login",t.loginForm).then((function(){t.initBackEndControlRoutes(),t.$router.push({path:"/projectManagement/index",query:t.otherQuery}),t.$message({type:"success",message:"Login successful!"}),t.loading=!1})).catch((function(){t.refreshCaptcha(),t.loading=!1}))}))},initBackEndControlRoutes:function(){var t=this;return Object(r["a"])(Object(n["a"])().mark((function e(){var a,s,o,r;return Object(n["a"])().wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,Object(i["a"])();case 2:a=e.sent,s=a.data.filter((function(t){return 12===t.id||13===t.id||14===t.id})),console.log("back res:",s),o=Object(c["a"])(s),console.log("routerConfig:",o),r=Object(c["b"])(o),t.$store.commit("permission/SET_ROUTES",r),Object(l["d"])(r);case 10:case"end":return e.stop()}}),e)})))()},getOtherQuery:function(t){return Object.keys(t).reduce((function(e,a){return"redirect"!==a&&(e[a]=t[a]),e}),{})}}},u=p,d=(a("c318"),a("2877")),h=Object(d["a"])(u,s,o,!1,null,null,null);e["default"]=h.exports},c318:function(t,e,a){"use strict";a("7e81")}}]);